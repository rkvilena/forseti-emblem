# ===========================================
# Fire Emblem RAG Backend - Environment Config
# ===========================================
# Copy this file to .env and fill in your values
# For local development, most defaults should work

# Environment: local | development | staging | production
ENVIRONMENT=local

# ===========================================
# Database Configuration (PostgreSQL + pgvector)
# ===========================================
# Option 1: Individual settings (recommended for clarity)
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USER=postgres
DATABASE_PASSWORD=postgres
DATABASE_NAME=forsetiemblem

# Option 2: Full connection URL (overrides individual settings)
# DATABASE_URL=postgresql+psycopg://postgres:postgres@localhost:5432/forsetiemblem

# ===========================================
# OpenAI Configuration
# ===========================================
# Get your API key from: https://platform.openai.com/api-keys
OPENAI_API_KEY=your-openai-api-key-here

# Model settings (defaults shown, change if needed)
OPENAI_EMBEDDING_MODEL=text-embedding-3-small
OPENAI_CHAT_MODEL=gpt-4o-mini

# ===========================================
# Server Configuration
# ===========================================
HOST=0.0.0.0
PORT=8000

# Local development settings
RELOAD=true
DEBUG=true

# Logging
LOG_LEVEL=DEBUG

# Protect Swagger/ReDoc/OpenAPI endpoints
# When ENVIRONMENT=production, setting username+password automatically enables protection.
# You can also force-enable via DOCS_AUTH_ENABLED=true.
DOCS_AUTH_ENABLED=true
DOCS_AUTH_MODE=session
DOCS_USERNAME=change-me
DOCS_PASSWORD=change-me
# Sign sessions (store this in Secret Manager in real deployments)
DOCS_SESSION_SECRET=change-me-to-a-long-random-string
# Re-auth after this many seconds
DOCS_SESSION_TTL_SECONDS=300

# Turnstile Configuration
TURNSTILE_SECRET_KEY=your-turnstile-secret-key-here
TURNSTILE_ENABLED=true

# ===========================================
# Redis / Rate Limiting
# ===========================================
# Redis connection URL used for IP rate limiting (e.g. redis://localhost:6379/0)
REDIS_URL=redis://localhost:6379/0

# Per-IP layered rate limiting for chat endpoints
# Short window: burst protection (e.g. per minute)
RATE_LIMIT_SHORT_WINDOW_SECONDS=60
RATE_LIMIT_SHORT_IP_REQUESTS=10

# Long window: total daily cap per IP
RATE_LIMIT_LONG_WINDOW_SECONDS=86400
RATE_LIMIT_LONG_IP_REQUESTS=100

# Per-session anonymous quota (long window)
SESSION_RATE_LIMIT_LONG_IP_REQUESTS=15
SESSION_COOKIE_NAME=fe_anon_session
SESSION_COOKIE_TTL_SECONDS=86400

# ===========================================
# Cost Controls
# ===========================================
# Max message length for chat endpoints
REQUEST_MAX_CHARS=300

# Max top_k for RAG retrieval (higher = more DB + OpenAI cost)
RAG_TOP_K_MAX=8

# Session cooldown: after this many quick requests, apply cooldown
SESSION_COOLDOWN_THRESHOLD=3
SESSION_COOLDOWN_WINDOW_SECONDS=60
SESSION_COOLDOWN_DURATION_SECONDS=30
